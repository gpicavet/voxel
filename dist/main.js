(()=>{var t={835:function(t){t.exports=function(){"use strict";return t.importState=function(r){var e=new t;return e.importState(r),e},t;function t(){return function(t){var r=0,e=0,o=0,i=1;0==t.length&&(t=[+new Date]);var n=function(){var t=4022871197,r=function(r){r=r.toString();for(var e=0;e<r.length;e++){var o=.02519603282416938*(t+=r.charCodeAt(e));o-=t=o>>>0,t=(o*=t)>>>0,t+=4294967296*(o-=t)}return 2.3283064365386963e-10*(t>>>0)};return r.version="Mash 0.9",r}();r=n(" "),e=n(" "),o=n(" ");for(var s=0;s<t.length;s++)(r-=n(t[s]))<0&&(r+=1),(e-=n(t[s]))<0&&(e+=1),(o-=n(t[s]))<0&&(o+=1);n=null;var a=function(){var t=2091639*r+2.3283064365386963e-10*i;return r=e,e=o,o=t-(i=0|t)};return a.next=a,a.uint32=function(){return 4294967296*a()},a.fract53=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.version="Alea 0.9",a.args=t,a.exportState=function(){return[r,e,o,i]},a.importState=function(t){r=+t[0]||0,e=+t[1]||0,o=+t[2]||0,i=+t[3]||0},a}(Array.prototype.slice.call(arguments))}}()},144:t=>{t.exports="#version 300 es\nprecision highp float;\nprecision lowp usampler3D;\n\nuniform usampler3D terrainTex;\nuniform vec3 lightDir; // Direction de la lumière (normalisée)\nuniform vec3 terrainOffset; // offset pour la texture\nuniform vec3 terrainDim; // dim pour la texture\n\nin vec3 vColor;\nin vec3 vPosition;\n\nout vec4 fragColor;\n\nfloat castShadowRay(vec3 startPos, vec3 lightDir) {\n    int maxSteps = 200;\n    vec3 pos = startPos;\n\n    // On avance pas à pas dans la direction de la lumière\n    for(int i = 0; i < maxSteps; i++) {\n        pos -= lightDir * 0.99f; // Petit pas\n        // normalise la coord tex entre 0 et 1\n        vec3 stu = pos + terrainOffset;\n        stu = vec3(stu.x / terrainDim.x, stu.y / terrainDim.y, stu.z / terrainDim.z);\n        if(stu.z < 1.0f && texture(terrainTex, stu).r > 0u) { // Si un voxel est rencontré\n            return 0.2f; // Ombre \n        }\n    }\n\n    return 1.0f; // Pas d'obstruction = pas d'ombre\n}\n\nvoid main() {\n\n    float shadow = castShadowRay(vPosition, lightDir);\n\n    vec3 color = vColor * 0.2f + vColor * 0.8f * shadow;\n\n    fragColor = vec4(color, 1);\n}"},202:t=>{t.exports="#version 300 es\n\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec4 position;\nlayout(location=1) in vec3 normal;\nlayout(location=2) in vec3 color;\n        \nuniform mat4 viewProj;\nuniform vec3 lightDir; // Direction de la lumière (normalisée)\n\nout vec3 vColor;\nout vec3 vPosition;\n\nvoid main() {\n    vColor = color * dot(normal, -lightDir);\n    //vColor = color;\n    vPosition = position.xyz;\n    gl_Position = viewProj * position;\n}"}},r={};function e(o){var i=r[o];if(void 0!==i)return i.exports;var n=r[o]={exports:{}};return t[o].call(n.exports,n,n.exports,e),n.exports}e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},e.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),(()=>{"use strict";var t=e(835),r=e.n(t),o=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var t=new i(3);return i!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function s(t,r,e){var o=new i(3);return o[0]=t,o[1]=r,o[2]=e,o}function a(t,r,e,o){return t[0]=r[0]+e[0]*o,t[1]=r[1]+e[1]*o,t[2]=r[2]+e[2]*o,t}function h(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function u(){var t=new i(16);return i!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)}),n();const l=1/3,f=1/6,c=t=>0|Math.floor(t),m=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function d(t,r,e,o){var i=function(t,r,e){for(var o=t.length,i=-1/0,n=1/0,s=0;s<o;s++){var a=(e[0][s]-t[s])/r[s],h=(e[1][s]-t[s])/r[s];if(a>h){var u=a;a=h,h=u}if(h<i||a>n)return 1/0;a>i&&(i=a),h<n&&(n=h)}return i>n?1/0:i}(r,e,o);if(i===1/0)t=null;else{t=t||[];for(var n=0;n<r.length;n++)t[n]=r[n]+e[n]*i}return{dist:i,point:t}}var v=e(202),p=e(144);const E=64;let A=-2.7,T=-.7,x=s(200,200,200),g=null;function y(t){g=t.key}function R(t){g=null}class _{constructor(t){this.dim=t,this.chunks=[],this.voxelTexture=null}init(t){const e=function(t=Math.random){const r=function(t){const r=new Uint8Array(512);for(let t=0;t<256;t++)r[t]=t;for(let e=0;e<255;e++){const o=e+~~(t()*(256-e)),i=r[e];r[e]=r[o],r[o]=i}for(let t=256;t<512;t++)r[t]=r[t-256];return r}(t),e=new Float64Array(r).map((t=>m[t%12*3])),o=new Float64Array(r).map((t=>m[t%12*3+1])),i=new Float64Array(r).map((t=>m[t%12*3+2]));return function(t,n,s){let a,h,u,m;const d=(t+n+s)*l,v=c(t+d),p=c(n+d),E=c(s+d),A=(v+p+E)*f,T=t-(v-A),x=n-(p-A),g=s-(E-A);let y,R,_,w,D,P;T>=x?x>=g?(y=1,R=0,_=0,w=1,D=1,P=0):T>=g?(y=1,R=0,_=0,w=1,D=0,P=1):(y=0,R=0,_=1,w=1,D=0,P=1):x<g?(y=0,R=0,_=1,w=0,D=1,P=1):T<g?(y=0,R=1,_=0,w=0,D=1,P=1):(y=0,R=1,_=0,w=1,D=1,P=0);const b=T-y+f,M=x-R+f,S=g-_+f,U=T-w+2*f,B=x-D+2*f,F=g-P+2*f,L=T-1+.5,I=x-1+.5,V=g-1+.5,k=255&v,C=255&p,X=255&E;let O=.6-T*T-x*x-g*g;if(O<0)a=0;else{const t=k+r[C+r[X]];O*=O,a=O*O*(e[t]*T+o[t]*x+i[t]*g)}let G=.6-b*b-M*M-S*S;if(G<0)h=0;else{const t=k+y+r[C+R+r[X+_]];G*=G,h=G*G*(e[t]*b+o[t]*M+i[t]*S)}let N=.6-U*U-B*B-F*F;if(N<0)u=0;else{const t=k+w+r[C+D+r[X+P]];N*=N,u=N*N*(e[t]*U+o[t]*B+i[t]*F)}let W=.6-L*L-I*I-V*V;if(W<0)m=0;else{const t=k+1+r[C+1+r[X+1]];W*=W,m=W*W*(e[t]*L+o[t]*I+i[t]*V)}return 32*(a+h+u+m)}}(r()("0"));console.log("generating chunks");const o=Math.floor(this.dim[0]/2),i=Math.floor(this.dim[1]/2),n=Math.floor(this.dim[2]/2);this.chunks=new Array(this.dim[0]);for(var a=0;a<this.dim[0];a++){this.chunks[a]=new Array(this.dim[1]);for(var h=0;h<this.dim[1];h++){this.chunks[a][h]=new Array(this.dim[2]);for(var u=0;u<this.dim[2];u++){const r=new w(6,s(a-o<<6,h-i<<6,u-n<<6));r.init(e),r.createArray(t),this.chunks[a][h][u]=r}}}console.log("generating 3D texture"),t.activeTexture(t.TEXTURE0),this.voxelTexture=t.createTexture(),t.bindTexture(t.TEXTURE_3D,this.voxelTexture),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE);const d=new Uint8Array(this.dim[0]*E*this.dim[1]*E*this.dim[2]*E);var v=0;for(u=0;u<this.dim[2]*E;u++)for(h=0;h<this.dim[1]*E;h++)for(a=0;a<this.dim[0]*E;a++){const t=u>>6,r=h>>6,e=a>>6,o=63&a,i=63&h,n=63&u;d[v++]=this.chunks[e][r][t].getVoxel(o,i,n)}t.texImage3D(t.TEXTURE_3D,0,t.R8UI,this.dim[0]*E,this.dim[1]*E,this.dim[2]*E,0,t.RED_INTEGER,t.UNSIGNED_BYTE,d)}updateTexture(t,r){for(var e of(console.log("updating 3D texture"),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_3D,this.voxelTexture),t)){const t=new Uint8Array(262144);for(var o=0,i=0;i<E;i++)for(var n=0;n<E;n++)for(var s=0;s<E;s++)t[o++]=e.getVoxel(s,n,i);r.texSubImage3D(r.TEXTURE_3D,0,e.pos[0]+Math.floor(this.dim[0]/2)*E,e.pos[1]+Math.floor(this.dim[1]/2)*E,e.pos[2],E,E,E,r.RED_INTEGER,r.UNSIGNED_BYTE,t)}}intersection(t,r){for(var e=[],o=0;o<this.dim[0];o++)for(var i=0;i<this.dim[1];i++)for(var n=0;n<this.dim[2];n++){const s=this.chunks[o][i][n],a=s.boxIntersection(t,r);a.dist!==1/0&&e.push({chunk:s,res:a})}for(var s of(e.sort(((t,r)=>t.res.dist-r.res.dist)),console.log(e.length),e)){const e=s.chunk.voxelIntersection(t,r);if(e)return{chunk:s.chunk,res:e}}return null}draw(t,r){for(var e=[],o=0;o<9;o++)for(var i=0;i<9;i++)for(var n=0;n<1;n++)e.push(this.chunks[o][i][n]);e.sort(((t,e)=>{const o=t.center(),i=e.center(),n=s(r[0]-o[0],r[1]-o[1],r[2]-o[2]),a=s(r[0]-i[0],r[1]-i[1],r[2]-i[2]);return h(n,n)-h(a,a)}));for(const r of e)r.draw(t)}}class w{constructor(t,r){this.dimPow=t,this.dim=1<<t,this.pos=r,this.voxels=new Array(this.dim*this.dim*this.dim),this.vertexArray=null,this.positionBuffer=null,this.normalBuffer=null,this.colorBuffer=null,this.nElements=0}center(){return s(this.pos[0]+this.dim/2,this.pos[1]+this.dim/2,this.pos[2]+this.dim/2)}setVoxel(t,r,e,o){this.voxels[((t<<this.dimPow)+r<<this.dimPow)+e]=o}getVoxel(t,r,e){return this.voxels[((t<<this.dimPow)+r<<this.dimPow)+e]}init(t){for(var r=0;r<this.dim;r++)for(var e=0;e<this.dim;e++)for(var o=0;o<this.dim;o++){var i=t(.01*(this.pos[0]+r),.01*(this.pos[1]+e),.01*(this.pos[2]+o));this.setVoxel(r,e,o,0),(o+this.pos[2]==0||i<-.4)&&this.setVoxel(r,e,o,1)}}boxIntersection(t,r){for(var e=n(),o=[[this.pos[0],this.pos[1],this.pos[2]],[this.pos[0]+this.dim,this.pos[1]+this.dim,this.pos[2]+this.dim]],i=!0,s=0;s<3;s++)if(o[0][s]<t[s]||t[s]>o[1][s]){i=!1;break}return i?{dist:0,point:null}:d(e,t,r,o)}voxelIntersection(t,r){for(var e=null,o=0;o<this.dim;o++)for(var i=0;i<this.dim;i++)for(var n=0;n<this.dim;n++)if(this.getVoxel(o,i,n)>0){for(var s=[this.pos[0]+o,this.pos[1]+i,this.pos[2]+n],a=[s,[s[0]+1,s[1]+1,s[2]+1]],h=!0,u=0;u<3;u++)if(a[0][u]<t[u]||t[u]>a[1][u]){h=!1;break}if(h){var l=[s[0]+.5-t[0],s[1]+.5-t[1],s[2]+.5-t[2]];return[Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]),s]}var f=d([0,0,0],t,r,a);f.dist!==1/0&&(null==e||e.dist>f.dist)&&(e=f)}return e}boom(t,r){if(t){console.log("boom ",t,r);for(var e=!1,o=r*r,i=(t=s(t[0]-this.pos[0],t[1]-this.pos[1],t[2]-this.pos[2]),0);i<this.dim;i++)for(var n=0;n<this.dim;n++)for(var a=0;a<this.dim;a++)if(this.getVoxel(i,n,a)>0){var h=[t[0]-i,t[1]-n,t[2]-a];h[0]*h[0]+h[1]*h[1]+h[2]*h[2]<o&&(this.setVoxel(i,n,a,0),e=!0)}return e}}createArray(t){const r=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5],e=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],o=[[0,1,2,3],[5,4,7,6],[4,5,1,0],[7,3,2,6],[1,5,6,2],[0,3,7,4]],i=[],n=[],s=[];for(var a=0;a<this.dim;a++)for(var h=0;h<this.dim;h++)for(var u=0;u<this.dim;u++)if(this.getVoxel(a,h,u)>0){const t=[];if(t[0]=a>=this.dim-1||0==this.getVoxel(a+1,h,u),t[1]=a<=0||0==this.getVoxel(a-1,h,u),t[2]=h>=this.dim-1||0==this.getVoxel(a,h+1,u),t[3]=h<=0||0==this.getVoxel(a,h-1,u),t[4]=u>=this.dim-1||0==this.getVoxel(a,h,u+1),t[5]=u<=0||0==this.getVoxel(a,h,u-1),t[0]||t[1]||t[2]||t[3]||t[4]||t[5]){var l=a+this.pos[0],f=h+this.pos[1],c=u+this.pos[2];const x=[.1,1,.2];var m=[.5,.4,.3];c>30&&(m=[.5,.5,.5]);var d=u+1;(d>=this.dim-1||0==this.getVoxel(a,h,d))&&(m=x);const g=[[[1,0,-1],[1,1,-1],[1,1,0],[1,1,1],[1,0,1],[1,-1,1],[1,-1,0],[1,-1,-1]],[[-1,0,-1],[-1,1,-1],[-1,1,0],[-1,1,1],[-1,0,1],[-1,-1,1],[-1,-1,0],[-1,-1,-1]],[[0,1,-1],[-1,1,-1],[-1,1,0],[-1,1,1],[0,1,1],[1,1,1],[1,1,0],[1,1,-1]],[[0,-1,-1],[-1,-1,-1],[-1,-1,0],[-1,-1,1],[0,-1,1],[1,-1,1],[1,-1,0],[1,-1,-1]],[[1,0,1],[1,1,1],[0,1,1],[-1,1,1],[-1,0,1],[-1,-1,1],[0,-1,1],[1,-1,1]],[[1,0,-1],[1,1,-1],[0,1,-1],[-1,1,-1],[-1,0,-1],[-1,-1,-1],[0,-1,-1],[1,-1,-1]]],y=[[0,1,2],[2,3,4],[4,5,6],[6,7,0]],R=t=>{const[r,e,o]=t;return(0==r||r<0&&a>0||r>0&&a<this.dim-1)&&(0==e||e<0&&h>0||e>0&&h<this.dim-1)&&(0==o||o<0&&u>0||o>0&&u<this.dim-1)&&this.getVoxel(a+r,h+e,u+o)>0};for(var v=0;v<6;v++)if(t[v]){const t=o[v];for(const o of[0,1,2,2,3,0]){const a=3*t[o],h=3*v;i.push(.5+r[a+0]+l),i.push(.5+r[a+1]+f),i.push(.5+r[a+2]+c),n.push(e[h+0]),n.push(e[h+1]),n.push(e[h+2]);const u=g[v];var p=1;if(v>=0){var E=R(u[y[o][0]]),A=R(u[y[o][1]]),T=R(u[y[o][2]]);E&&T?p=.25:E&&A||T&&A?p=.5:(T||T||A)&&(p=.75)}s.push(m[0]*p),s.push(m[1]*p),s.push(m[2]*p)}}}}var x=new Float32Array(i),g=new Float32Array(n),y=new Float32Array(s);null==this.vertexArray&&(this.vertexArray=t.createVertexArray()),t.bindVertexArray(this.vertexArray),null!=this.positionBuffer&&t.deleteBuffer(this.positionBuffer),this.positionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,x,t.STATIC_DRAW),t.vertexAttribPointer(0,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(0),null!=this.normalBuffer&&t.deleteBuffer(this.normalBuffer),this.normalBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.normalBuffer),t.bufferData(t.ARRAY_BUFFER,g,t.STATIC_DRAW),t.vertexAttribPointer(1,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(1),null!=this.colorBuffer&&t.deleteBuffer(this.colorBuffer),this.colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,y,t.STATIC_DRAW),t.vertexAttribPointer(2,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(2),this.nElements=x.length/3,console.log("chunk created with "+this.nElements+" vertices")}draw(t){t.bindVertexArray(this.vertexArray),t.drawArrays(t.TRIANGLES,0,this.nElements)}}!function(){var t=document.getElementById("gl-canvas");t.width=window.innerWidth,t.height=window.innerHeight,document.addEventListener("keydown",y,!1),document.addEventListener("keyup",R,!1);var r=t.getContext("webgl2");r||(console.error("WebGL 2 not available"),document.body.innerHTML="This example requires WebGL 2 which is unavailable on this system."),r.clearColor(0,0,0,1);var e=v.trim(),i=r.createShader(r.VERTEX_SHADER);r.shaderSource(i,e),r.compileShader(i),r.getShaderParameter(i,r.COMPILE_STATUS)||console.error(r.getShaderInfoLog(i));var h=p.trim(),l=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(l,h),r.compileShader(l),r.getShaderParameter(l,r.COMPILE_STATUS)||console.error(r.getShaderInfoLog(l));var f=r.createProgram();r.attachShader(f,i),r.attachShader(f,l),r.linkProgram(f),r.getProgramParameter(f,r.LINK_STATUS)||console.error(r.getProgramInfoLog(f)),r.useProgram(f);const c=new _(s(9,9,1));c.init(r);var m=r.getUniformLocation(f,"terrainTex");r.uniform1i(m,0);var d=r.getUniformLocation(f,"terrainOffset");r.uniform3fv(d,s(E*Math.floor(c.dim[0]/2),E*Math.floor(c.dim[1]/2),E*Math.floor(c.dim[2]/2)));var w=r.getUniformLocation(f,"terrainDim");r.uniform3fv(w,s(E*c.dim[0],E*c.dim[1],E*c.dim[2]));var D,P,b,M,S,U,B,F=u();D=F,P=Math.PI/4,b=r.drawingBufferWidth/r.drawingBufferHeight,M=.1,S=1e3,B=1/Math.tan(P/2),D[0]=B/b,D[1]=0,D[2]=0,D[3]=0,D[4]=0,D[5]=B,D[6]=0,D[7]=0,D[8]=0,D[9]=0,D[11]=-1,D[12]=0,D[13]=0,D[15]=0,null!=S&&S!==1/0?(U=1/(M-S),D[10]=(S+M)*U,D[14]=2*S*M*U):(D[10]=-1,D[14]=-2*M);var L=r.getUniformLocation(f,"lightDir"),I=u(),V=u(),k=u(),C=0;const X=r.getExtension("EXT_disjoint_timer_query_webgl2");var O=Date.now();r.enable(r.DEPTH_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),document.getElementById("loading").style.display="none",requestAnimationFrame((function t(){const e=r.createQuery();r.beginQuery(X.TIME_ELAPSED_EXT,e),C+=.005,"q"!=g&&"ArrowLeft"!=g||(A+=.01),"d"!=g&&"ArrowRight"!=g||(A-=.01),"z"==g&&(T+=.01),"s"==g&&(T-=.01);var i=s(Math.cos(A)*Math.cos(T),Math.sin(A)*Math.cos(T),Math.sin(T));if(" "==g){const t=c.intersection(x,i);t&&t.chunk.boom(t.res.point,10)&&(t.chunk.createArray(r),c.updateTexture([t.chunk],r))}"ArrowUp"==g&&a(x,x,i,1),"ArrowDown"==g&&a(x,x,i,-1);var h,u,l,m=n();u=x,l=i,(h=m)[0]=u[0]+l[0],h[1]=u[1]+l[1],h[2]=u[2]+l[2],function(t,r,e,i){var n,s,a,h,u,l,f,c,m,d,v=r[0],p=r[1],E=r[2],A=i[0],T=i[1],x=i[2],g=e[0],y=e[1],R=e[2];Math.abs(v-g)<o&&Math.abs(p-y)<o&&Math.abs(E-R)<o?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(f=v-g,c=p-y,m=E-R,n=T*(m*=d=1/Math.hypot(f,c,m))-x*(c*=d),s=x*(f*=d)-A*m,a=A*c-T*f,(d=Math.hypot(n,s,a))?(n*=d=1/d,s*=d,a*=d):(n=0,s=0,a=0),h=c*a-m*s,u=m*n-f*a,l=f*s-c*n,(d=Math.hypot(h,u,l))?(h*=d=1/d,u*=d,l*=d):(h=0,u=0,l=0),t[0]=n,t[1]=h,t[2]=f,t[3]=0,t[4]=s,t[5]=u,t[6]=c,t[7]=0,t[8]=a,t[9]=l,t[10]=m,t[11]=0,t[12]=-(n*v+s*p+a*E),t[13]=-(h*v+u*p+l*E),t[14]=-(f*v+c*p+m*E),t[15]=1)}(I,x,m=h,s(0,0,1)),function(t,r,e){var o=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],u=r[6],l=r[7],f=r[8],c=r[9],m=r[10],d=r[11],v=r[12],p=r[13],E=r[14],A=r[15],T=e[0],x=e[1],g=e[2],y=e[3];t[0]=T*o+x*a+g*f+y*v,t[1]=T*i+x*h+g*c+y*p,t[2]=T*n+x*u+g*m+y*E,t[3]=T*s+x*l+g*d+y*A,T=e[4],x=e[5],g=e[6],y=e[7],t[4]=T*o+x*a+g*f+y*v,t[5]=T*i+x*h+g*c+y*p,t[6]=T*n+x*u+g*m+y*E,t[7]=T*s+x*l+g*d+y*A,T=e[8],x=e[9],g=e[10],y=e[11],t[8]=T*o+x*a+g*f+y*v,t[9]=T*i+x*h+g*c+y*p,t[10]=T*n+x*u+g*m+y*E,t[11]=T*s+x*l+g*d+y*A,T=e[12],x=e[13],g=e[14],y=e[15],t[12]=T*o+x*a+g*f+y*v,t[13]=T*i+x*h+g*c+y*p,t[14]=T*n+x*u+g*m+y*E,t[15]=T*s+x*l+g*d+y*A}(V,F,I);var d=r.getUniformLocation(f,"viewProj");r.uniformMatrix4fv(d,!1,V),function(t,r){var e=Math.sin(r),o=Math.cos(r);t[0]=o,t[1]=e,t[2]=0,t[3]=0,t[4]=-e,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(k,C);var v=s(-1,-1,-1);v=function(t,r){var e=r[0],o=r[1],i=r[2],n=e*e+o*o+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t}(v,v),function(t,r,e){var o=r[0],i=r[1],n=r[2],s=e[3]*o+e[7]*i+e[11]*n+e[15];s=s||1,t[0]=(e[0]*o+e[4]*i+e[8]*n+e[12])/s,t[1]=(e[1]*o+e[5]*i+e[9]*n+e[13])/s,t[2]=(e[2]*o+e[6]*i+e[10]*n+e[14])/s}(v,v,k),r.uniform3fv(L,v),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),c.draw(r,x),r.endQuery(X.TIME_ELAPSED_EXT),Date.now()-O>1e3&&setTimeout((()=>{r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE)&&(O=Date.now(),r.getQueryParameter(e,r.QUERY_RESULT))}),100),requestAnimationFrame(t)}))}()})()})();