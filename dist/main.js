(()=>{var t={835:function(t){t.exports=function(){"use strict";return t.importState=function(r){var e=new t;return e.importState(r),e},t;function t(){return function(t){var r=0,e=0,o=0,n=1;0==t.length&&(t=[+new Date]);var i=function(){var t=4022871197,r=function(r){r=r.toString();for(var e=0;e<r.length;e++){var o=.02519603282416938*(t+=r.charCodeAt(e));o-=t=o>>>0,t=(o*=t)>>>0,t+=4294967296*(o-=t)}return 2.3283064365386963e-10*(t>>>0)};return r.version="Mash 0.9",r}();r=i(" "),e=i(" "),o=i(" ");for(var a=0;a<t.length;a++)(r-=i(t[a]))<0&&(r+=1),(e-=i(t[a]))<0&&(e+=1),(o-=i(t[a]))<0&&(o+=1);i=null;var s=function(){var t=2091639*r+2.3283064365386963e-10*n;return r=e,e=o,o=t-(n=0|t)};return s.next=s,s.uint32=function(){return 4294967296*s()},s.fract53=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.version="Alea 0.9",s.args=t,s.exportState=function(){return[r,e,o,n]},s.importState=function(t){r=+t[0]||0,e=+t[1]||0,o=+t[2]||0,n=+t[3]||0},s}(Array.prototype.slice.call(arguments))}}()},144:t=>{t.exports="#version 300 es\nprecision highp float;\nprecision lowp usampler3D;\n\nuniform usampler3D terrainTex;\nuniform vec3 lightDir; // Direction de la lumière (normalisée)\nuniform vec3 terrainOffset; // offset pour la texture\nuniform vec3 terrainDim; // dim pour la texture\n\nin vec3 vColor;\nin vec3 vPosition;\n\nout vec4 fragColor;\n\nfloat castShadowRay(vec3 startPos, vec3 lightDir) {\n    int maxSteps = 200;\n    vec3 pos = startPos;\n\n    // On avance pas à pas dans la direction de la lumière\n    for(int i = 0; i < maxSteps; i++) {\n        pos -= lightDir * 0.75f; // Petit pas\n        // normalise la coord tex entre 0 et 1\n        vec3 stu = pos + terrainOffset;\n        stu = vec3(stu.x / terrainDim.x, stu.y / terrainDim.y, stu.z / terrainDim.z);\n        if(stu.z < 1.0f && texture(terrainTex, stu).r > 0u) { // Si un voxel est rencontré\n            return 0.2f; // Ombre \n        }\n    }\n\n    return 1.0f; // Pas d'obstruction = pas d'ombre\n}\n\nvoid main() {\n\n    float shadow = castShadowRay(vPosition, lightDir);\n\n    vec3 color = vColor * 0.2f + vColor * 0.8f * shadow;\n\n    //fog\n    float a = gl_FragCoord.z / gl_FragCoord.w * 0.001f;\n    color = color * (1.0f - a) + vec3(0.7f, 0.9f, 1) * a;\n\n    fragColor = vec4(color, 1);\n}"},202:t=>{t.exports="#version 300 es\n\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec4 position;\nlayout(location=1) in vec3 normal;\nlayout(location=2) in vec3 color;\n        \nuniform mat4 viewProj;\nuniform vec3 lightDir; // Direction de la lumière (normalisée)\n\nout vec3 vColor;\nout vec3 vPosition;\n\nvoid main() {\n    vColor = color * dot(normal, -lightDir);\n    //vColor = color;\n    vPosition = position.xyz;\n    gl_Position = viewProj * position;\n}"}},r={};function e(o){var n=r[o];if(void 0!==n)return n.exports;var i=r[o]={exports:{}};return t[o].call(i.exports,i,i.exports,e),i.exports}e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},e.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),(()=>{"use strict";var t=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array;function o(){var t=new r(3);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function n(t,e,o){var n=new r(3);return n[0]=t,n[1]=e,n[2]=o,n}function i(t,r,e,o){return t[0]=r[0]+e[0]*o,t[1]=r[1]+e[1]*o,t[2]=r[2]+e[2]*o,t}function a(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function s(){var t=new r(16);return r!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)}),o();function h(t,r,e){for(var o=-1/0,n=1/0,i=0;i<3;++i)if(r[i]>=1e-6||r[i]<=-1e-6){var a=(e[0][i]-t[i])/r[i],s=(e[1][i]-t[i])/r[i];o=Math.max(o,Math.min(a,s)),n=Math.min(n,Math.max(a,s))}else if(t[i]<e[0][i]||t[i]>e[1][i])return 1/0;return n<o||n<0?1/0:o>0?o:1/0}class f{static SIZE_POW=6;static SIZE=1<<f.SIZE_POW;static SIZE_HALF=f.SIZE>>1;constructor(t){this.pos=t,this.voxels=new Array(f.SIZE*f.SIZE*f.SIZE),this.vertexArray=null,this.positionBuffer=null,this.normalBuffer=null,this.colorBuffer=null,this.nElements=0}center(){return n(this.pos[0]+f.SIZE_HALF,this.pos[1]+f.SIZE_HALF,this.pos[2]+f.SIZE_HALF)}setVoxel(t,r,e,o){this.voxels[((t<<f.SIZE_POW)+r<<f.SIZE_POW)+e]=o}getVoxel(t,r,e){return this.voxels[((t<<f.SIZE_POW)+r<<f.SIZE_POW)+e]}init(t){for(var r=0;r<f.SIZE;r++)for(var e=0;e<f.SIZE;e++)for(var o=0;o<f.SIZE;o++){var n=t(.01*(this.pos[0]+r),.01*(this.pos[1]+e),.01*(this.pos[2]+o));this.setVoxel(r,e,o,0),(o+this.pos[2]==0||n<-.1)&&this.setVoxel(r,e,o,1)}}bbIntersectionWithRay(t,r){for(var e=[[this.pos[0],this.pos[1],this.pos[2]],[this.pos[0]+f.SIZE,this.pos[1]+f.SIZE,this.pos[2]+f.SIZE]],o=!0,n=0;n<3;n++)if(e[0][n]>t[n]||t[n]>e[1][n]){o=!1;break}return o?{dist:0}:{dist:h(t,r,e)}}bbIntersectionWithSphere(t,r){var e=[[this.pos[0],this.pos[1],this.pos[2]],[this.pos[0]+f.SIZE,this.pos[1]+f.SIZE,this.pos[2]+f.SIZE]];const o=r*r;for(var n=0,i=0;i<3;i++)t[i]<e[0][i]?n+=(t[i]-e[0][i])*(t[i]-e[0][i]):t[i]>e[1][i]&&(n+=(t[i]-e[1][i])*(t[i]-e[1][i]));return n<=o}voxelIntersection(t,r){for(var e=null,o=0;o<f.SIZE;o++)for(var n=0;n<f.SIZE;n++)for(var i=0;i<f.SIZE;i++)if(this.getVoxel(o,n,i)>0){const f=[this.pos[0]+o,this.pos[1]+n,this.pos[2]+i],u=[f,[f[0]+1,f[1]+1,f[2]+1]];for(var a=!0,s=0;s<3;s++)if(u[0][s]<t[s]||t[s]>u[1][s]){a=!1;break}if(a){const r=[f[0]+.5-t[0],f[1]+.5-t[1],f[2]+.5-t[2]];return{dist:Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),point:f}}{const o=h(t,r,u);o!==1/0&&o>=0&&(null==e||e.dist>o)&&(e={dist:o,point:[t[0]+o*r[0],t[1]+o*r[1],t[2]+o*r[2]]})}}return e}boom(t,r){if(t){console.log("boom ",t,r);for(var e=!1,o=r*r,i=(t=n(t[0]-this.pos[0],t[1]-this.pos[1],t[2]-this.pos[2]),0);i<f.SIZE;i++)for(var a=0;a<f.SIZE;a++)for(var s=0;s<f.SIZE;s++)if(this.getVoxel(i,a,s)>0){var h=[t[0]-i,t[1]-a,t[2]-s];h[0]*h[0]+h[1]*h[1]+h[2]*h[2]<o&&(this.setVoxel(i,a,s,0),e=!0)}return e}}createArray(t){const r=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5],e=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],o=[[0,1,2,3],[5,4,7,6],[4,5,1,0],[7,3,2,6],[1,5,6,2],[0,3,7,4]],n=[],i=[],a=[];for(var s=0;s<f.SIZE;s++)for(var h=0;h<f.SIZE;h++)for(var u=0;u<f.SIZE;u++)if(this.getVoxel(s,h,u)>0){const t=[];if(t[0]=s>=f.SIZE-1||0==this.getVoxel(s+1,h,u),t[1]=s<=0||0==this.getVoxel(s-1,h,u),t[2]=h>=f.SIZE-1||0==this.getVoxel(s,h+1,u),t[3]=h<=0||0==this.getVoxel(s,h-1,u),t[4]=u>=f.SIZE-1||0==this.getVoxel(s,h,u+1),t[5]=u<=0||0==this.getVoxel(s,h,u-1),t[0]||t[1]||t[2]||t[3]||t[4]||t[5]){var l=s+this.pos[0],c=h+this.pos[1],E=u+this.pos[2];const T=[.1,1,.2];var v=[.5,.4,.3];E>30&&(v=[.5,.5,.5]);var m=u+1;(m>=f.SIZE-1||0==this.getVoxel(s,h,m))&&(v=T);const x=[[[1,0,-1],[1,1,-1],[1,1,0],[1,1,1],[1,0,1],[1,-1,1],[1,-1,0],[1,-1,-1]],[[-1,0,-1],[-1,1,-1],[-1,1,0],[-1,1,1],[-1,0,1],[-1,-1,1],[-1,-1,0],[-1,-1,-1]],[[0,1,-1],[-1,1,-1],[-1,1,0],[-1,1,1],[0,1,1],[1,1,1],[1,1,0],[1,1,-1]],[[0,-1,-1],[-1,-1,-1],[-1,-1,0],[-1,-1,1],[0,-1,1],[1,-1,1],[1,-1,0],[1,-1,-1]],[[1,0,1],[1,1,1],[0,1,1],[-1,1,1],[-1,0,1],[-1,-1,1],[0,-1,1],[1,-1,1]],[[1,0,-1],[1,1,-1],[0,1,-1],[-1,1,-1],[-1,0,-1],[-1,-1,-1],[0,-1,-1],[1,-1,-1]]],g=[[0,1,2],[2,3,4],[4,5,6],[6,7,0]],_=t=>{const[r,e,o]=t;return(0==r||r<0&&s>0||r>0&&s<f.SIZE-1)&&(0==e||e<0&&h>0||e>0&&h<f.SIZE-1)&&(0==o||o<0&&u>0||o>0&&u<f.SIZE-1)&&this.getVoxel(s+r,h+e,u+o)>0};for(var d=0;d<6;d++)if(t[d]){const t=o[d];for(const o of[0,1,2,2,3,0]){const s=3*t[o],h=3*d;n.push(.5+r[s+0]+l),n.push(.5+r[s+1]+c),n.push(.5+r[s+2]+E),i.push(e[h+0]),i.push(e[h+1]),i.push(e[h+2]);const f=x[d];var S=1;if(d>=0){var I=_(f[g[o][0]]),p=_(f[g[o][1]]),A=_(f[g[o][2]]);I&&A?S=.25:I&&p||A&&p?S=.5:(A||A||p)&&(S=.75)}a.push(v[0]*S),a.push(v[1]*S),a.push(v[2]*S)}}}}var T=new Float32Array(n),x=new Float32Array(i),g=new Float32Array(a);null==this.vertexArray&&(this.vertexArray=t.createVertexArray()),t.bindVertexArray(this.vertexArray),null!=this.positionBuffer&&t.deleteBuffer(this.positionBuffer),this.positionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,T,t.STATIC_DRAW),t.vertexAttribPointer(0,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(0),null!=this.normalBuffer&&t.deleteBuffer(this.normalBuffer),this.normalBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.normalBuffer),t.bufferData(t.ARRAY_BUFFER,x,t.STATIC_DRAW),t.vertexAttribPointer(1,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(1),null!=this.colorBuffer&&t.deleteBuffer(this.colorBuffer),this.colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,g,t.STATIC_DRAW),t.vertexAttribPointer(2,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(2),this.nElements=T.length/3,console.log("chunk created with "+this.nElements+" vertices")}draw(t){t.bindVertexArray(this.vertexArray),t.drawArrays(t.TRIANGLES,0,this.nElements)}}var u=e(835),l=e.n(u);const c=1/3,E=1/6,v=t=>0|Math.floor(t),m=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);class d{constructor(t){this.dim=t,this.chunks=[],this.voxelTexture=null}init(t){const r=function(t=Math.random){const r=function(t){const r=new Uint8Array(512);for(let t=0;t<256;t++)r[t]=t;for(let e=0;e<255;e++){const o=e+~~(t()*(256-e)),n=r[e];r[e]=r[o],r[o]=n}for(let t=256;t<512;t++)r[t]=r[t-256];return r}(t),e=new Float64Array(r).map((t=>m[t%12*3])),o=new Float64Array(r).map((t=>m[t%12*3+1])),n=new Float64Array(r).map((t=>m[t%12*3+2]));return function(t,i,a){let s,h,f,u;const l=(t+i+a)*c,m=v(t+l),d=v(i+l),S=v(a+l),I=(m+d+S)*E,p=t-(m-I),A=i-(d-I),T=a-(S-I);let x,g,_,Z,y,R;p>=A?A>=T?(x=1,g=0,_=0,Z=1,y=1,R=0):p>=T?(x=1,g=0,_=0,Z=1,y=0,R=1):(x=0,g=0,_=1,Z=1,y=0,R=1):A<T?(x=0,g=0,_=1,Z=0,y=1,R=1):p<T?(x=0,g=1,_=0,Z=0,y=1,R=1):(x=0,g=1,_=0,Z=1,y=1,R=0);const w=p-x+E,P=A-g+E,b=T-_+E,D=p-Z+2*E,M=A-y+2*E,F=T-R+2*E,U=p-1+.5,B=A-1+.5,L=T-1+.5,O=255&m,V=255&d,W=255&S;let C=.6-p*p-A*A-T*T;if(C<0)s=0;else{const t=O+r[V+r[W]];C*=C,s=C*C*(e[t]*p+o[t]*A+n[t]*T)}let k=.6-w*w-P*P-b*b;if(k<0)h=0;else{const t=O+x+r[V+g+r[W+_]];k*=k,h=k*k*(e[t]*w+o[t]*P+n[t]*b)}let X=.6-D*D-M*M-F*F;if(X<0)f=0;else{const t=O+Z+r[V+y+r[W+R]];X*=X,f=X*X*(e[t]*D+o[t]*M+n[t]*F)}let G=.6-U*U-B*B-L*L;if(G<0)u=0;else{const t=O+1+r[V+1+r[W+1]];G*=G,u=G*G*(e[t]*U+o[t]*B+n[t]*L)}return 32*(s+h+f+u)}}(l()("0"));console.log("generating chunks");const e=Math.floor(this.dim[0]/2),o=Math.floor(this.dim[1]/2),i=Math.floor(this.dim[2]/2);this.chunks=new Array(this.dim[0]);for(var a=0;a<this.dim[0];a++){this.chunks[a]=new Array(this.dim[1]);for(var s=0;s<this.dim[1];s++){this.chunks[a][s]=new Array(this.dim[2]);for(var h=0;h<this.dim[2];h++){const u=new f(n(a-e<<f.SIZE_POW,s-o<<f.SIZE_POW,h-i<<f.SIZE_POW));this.chunks[a][s][h]=u,u.init(r),u.createArray(t)}}}console.log("generating 3D texture"),t.activeTexture(t.TEXTURE0),this.voxelTexture=t.createTexture(),t.bindTexture(t.TEXTURE_3D,this.voxelTexture),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE);const u=new Uint8Array(this.dim[0]*f.SIZE*this.dim[1]*f.SIZE*this.dim[2]*f.SIZE);var d=0;for(h=0;h<this.dim[2]*f.SIZE;h++)for(s=0;s<this.dim[1]*f.SIZE;s++)for(a=0;a<this.dim[0]*f.SIZE;a++){const t=h>>f.SIZE_POW,r=s>>f.SIZE_POW,e=a>>f.SIZE_POW,o=a&f.SIZE-1,n=s&f.SIZE-1,i=h&f.SIZE-1;u[d++]=this.chunks[e][r][t].getVoxel(o,n,i)}t.texImage3D(t.TEXTURE_3D,0,t.R8UI,this.dim[0]*f.SIZE,this.dim[1]*f.SIZE,this.dim[2]*f.SIZE,0,t.RED_INTEGER,t.UNSIGNED_BYTE,u)}updateTexture(t,r){for(var e of(console.log("updating 3D texture"),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_3D,this.voxelTexture),t)){const t=new Uint8Array(f.SIZE*f.SIZE*f.SIZE);for(var o=0,n=0;n<f.SIZE;n++)for(var i=0;i<f.SIZE;i++)for(var a=0;a<f.SIZE;a++)t[o++]=e.getVoxel(a,i,n);r.texSubImage3D(r.TEXTURE_3D,0,e.pos[0]+Math.floor(this.dim[0]/2)*f.SIZE,e.pos[1]+Math.floor(this.dim[1]/2)*f.SIZE,e.pos[2]+Math.floor(this.dim[2]/2)*f.SIZE,f.SIZE,f.SIZE,f.SIZE,r.RED_INTEGER,r.UNSIGNED_BYTE,t)}}intersection(t,r){for(var e=[],o=0;o<this.dim[0];o++)for(var n=0;n<this.dim[1];n++)for(var i=0;i<this.dim[2];i++){const a=this.chunks[o][n][i],s=a.bbIntersectionWithRay(t,r);s.dist!==1/0&&s.dist>=0&&e.push({chunk:a,res:s})}for(var a of(e.sort(((t,r)=>t.res.dist-r.res.dist)),e)){const e=a.chunk.voxelIntersection(t,r);if(e)return{chunk:a.chunk,res:e}}return null}boom(t,r,e){if(r){for(var o=[],n=0;n<this.dim[0];n++)for(var i=0;i<this.dim[1];i++)for(var a=0;a<this.dim[2];a++){const o=this.chunks[n][i][a];o.bbIntersectionWithSphere(r,e)&&o.boom(r,10)&&o.createArray(t)}o.length>0&&this.updateTexture(o,t)}}draw(t,r){for(var e=[],o=0;o<this.dim[0];o++)for(var i=0;i<this.dim[1];i++)for(var s=0;s<this.dim[2];s++)e.push(this.chunks[o][i][s]);e.sort(((t,e)=>{const o=t.center(),i=e.center(),s=n(r[0]-o[0],r[1]-o[1],r[2]-o[2]),h=n(r[0]-i[0],r[1]-i[1],r[2]-i[2]);return a(s,s)-a(h,h)}));for(const r of e)r.draw(t)}}var S=e(202),I=e(144);let p=0,A=0,T=n(0,0,30),x={};function g(t){x[t.key]=!0}function _(t){delete x[t.key]}!function(){var r=document.getElementById("gl-canvas");r.width=window.innerWidth,r.height=window.innerHeight,document.addEventListener("keydown",g,!1),document.addEventListener("keyup",_,!1);var e=r.getContext("webgl2");e||(console.error("WebGL 2 not available"),document.body.innerHTML="This example requires WebGL 2 which is unavailable on this system.");var a=S.trim(),h=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(h,a),e.compileShader(h),!e.getShaderParameter(h,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(h));var u=I.trim(),l=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(l,u),e.compileShader(l),!e.getShaderParameter(l,e.COMPILE_STATUS))throw new Error("Vertex shader error : "+e.getShaderInfoLog(l));var c=e.createProgram();e.attachShader(c,h),e.attachShader(c,l),e.linkProgram(c),e.getProgramParameter(c,e.LINK_STATUS)||console.error("Fragment shader error : "+e.getProgramInfoLog(c)),e.useProgram(c);const E=new d(n(9,9,1));E.init(e);var v=e.getUniformLocation(c,"terrainTex");e.uniform1i(v,0);var m=e.getUniformLocation(c,"terrainOffset");e.uniform3fv(m,n(f.SIZE*Math.floor(E.dim[0]/2),f.SIZE*Math.floor(E.dim[1]/2),f.SIZE*Math.floor(E.dim[2]/2)));var Z=e.getUniformLocation(c,"terrainDim");e.uniform3fv(Z,n(f.SIZE*E.dim[0],f.SIZE*E.dim[1],f.SIZE*E.dim[2]));var y,R,w,P,b,D,M,F=s();y=F,R=Math.PI/4,w=e.drawingBufferWidth/e.drawingBufferHeight,P=.1,b=1e3,M=1/Math.tan(R/2),y[0]=M/w,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=M,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,null!=b&&b!==1/0?(D=1/(P-b),y[10]=(b+P)*D,y[14]=2*b*P*D):(y[10]=-1,y[14]=-2*P);var U=e.getUniformLocation(c,"lightDir"),B=s(),L=s(),O=s(),V=0;const W=e.getExtension("EXT_disjoint_timer_query_webgl2");var C=Date.now();e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.clearColor(.8,.9,1,1),document.getElementById("loading").style.display="none",requestAnimationFrame((function r(){const a=e.createQuery();e.beginQuery(W.TIME_ELAPSED_EXT,a),V+=.005,(x.q||x.ArrowLeft)&&(p+=.01),(x.d||x.ArrowRight)&&(p-=.01),x.z&&(A+=.01),x.s&&(A-=.01);var s=n(Math.cos(p)*Math.cos(A),Math.sin(p)*Math.cos(A),Math.sin(A));if(x[" "]){const t=E.intersection(T,s);t&&E.boom(e,t.res.point,10)}x.ArrowUp&&i(T,T,s,1),x.ArrowDown&&i(T,T,s,-1);var h,f,u,l=o();f=T,u=s,(h=l)[0]=f[0]+u[0],h[1]=f[1]+u[1],h[2]=f[2]+u[2],function(r,e,o,n){var i,a,s,h,f,u,l,c,E,v,m=e[0],d=e[1],S=e[2],I=n[0],p=n[1],A=n[2],T=o[0],x=o[1],g=o[2];Math.abs(m-T)<t&&Math.abs(d-x)<t&&Math.abs(S-g)<t?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(r):(l=m-T,c=d-x,E=S-g,i=p*(E*=v=1/Math.hypot(l,c,E))-A*(c*=v),a=A*(l*=v)-I*E,s=I*c-p*l,(v=Math.hypot(i,a,s))?(i*=v=1/v,a*=v,s*=v):(i=0,a=0,s=0),h=c*s-E*a,f=E*i-l*s,u=l*a-c*i,(v=Math.hypot(h,f,u))?(h*=v=1/v,f*=v,u*=v):(h=0,f=0,u=0),r[0]=i,r[1]=h,r[2]=l,r[3]=0,r[4]=a,r[5]=f,r[6]=c,r[7]=0,r[8]=s,r[9]=u,r[10]=E,r[11]=0,r[12]=-(i*m+a*d+s*S),r[13]=-(h*m+f*d+u*S),r[14]=-(l*m+c*d+E*S),r[15]=1)}(B,T,l=h,n(0,0,1)),function(t,r,e){var o=r[0],n=r[1],i=r[2],a=r[3],s=r[4],h=r[5],f=r[6],u=r[7],l=r[8],c=r[9],E=r[10],v=r[11],m=r[12],d=r[13],S=r[14],I=r[15],p=e[0],A=e[1],T=e[2],x=e[3];t[0]=p*o+A*s+T*l+x*m,t[1]=p*n+A*h+T*c+x*d,t[2]=p*i+A*f+T*E+x*S,t[3]=p*a+A*u+T*v+x*I,p=e[4],A=e[5],T=e[6],x=e[7],t[4]=p*o+A*s+T*l+x*m,t[5]=p*n+A*h+T*c+x*d,t[6]=p*i+A*f+T*E+x*S,t[7]=p*a+A*u+T*v+x*I,p=e[8],A=e[9],T=e[10],x=e[11],t[8]=p*o+A*s+T*l+x*m,t[9]=p*n+A*h+T*c+x*d,t[10]=p*i+A*f+T*E+x*S,t[11]=p*a+A*u+T*v+x*I,p=e[12],A=e[13],T=e[14],x=e[15],t[12]=p*o+A*s+T*l+x*m,t[13]=p*n+A*h+T*c+x*d,t[14]=p*i+A*f+T*E+x*S,t[15]=p*a+A*u+T*v+x*I}(L,F,B);var v=e.getUniformLocation(c,"viewProj");e.uniformMatrix4fv(v,!1,L),function(t,r){var e=Math.sin(r),o=Math.cos(r);t[0]=o,t[1]=e,t[2]=0,t[3]=0,t[4]=-e,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(O,V);var m=n(-1,-1,-1);m=function(t,r){var e=r[0],o=r[1],n=r[2],i=e*e+o*o+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t}(m,m),function(t,r,e){var o=r[0],n=r[1],i=r[2],a=e[3]*o+e[7]*n+e[11]*i+e[15];a=a||1,t[0]=(e[0]*o+e[4]*n+e[8]*i+e[12])/a,t[1]=(e[1]*o+e[5]*n+e[9]*i+e[13])/a,t[2]=(e[2]*o+e[6]*n+e[10]*i+e[14])/a}(m,m,O),e.uniform3fv(U,m),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),E.draw(e,T),e.endQuery(W.TIME_ELAPSED_EXT),Date.now()-C>1e3&&setTimeout((()=>{e.getQueryParameter(a,e.QUERY_RESULT_AVAILABLE)&&(C=Date.now(),e.getQueryParameter(a,e.QUERY_RESULT))}),100),requestAnimationFrame(r)}))}()})()})();